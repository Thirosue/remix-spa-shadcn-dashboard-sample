import{j as e}from"./jsx-runtime-BoP3Okkf.js";import{c as E,n as I,o as M,s as g,a as q,u as z,t as A,b as l,F as U,d as n,e as c,f as h,g as d,h as a}from"./auth-Djbxpo_t.js";import{B as f}from"./button-CGLTyWrZ.js";import{I as b}from"./icons-j5Z6QLy3.js";import{H as B,S as H}from"./separator-DnpcH1gh.js";import{p as V,a as $,l as L,d as Q}from"./logger-B_ZFLNfA.js";import{I as i}from"./input-ClZrOYka.js";import{u as R}from"./use-toast-dkzHwJmT.js";import{u as G}from"./confirm-provider-BNrJVGJH.js";import{c as J}from"./index-DCc76cjq.js";import{T as K}from"./trash-C6rcx_Kb.js";const O=E.extend({version:I().optional()}),W=M({name:g().min(3,{message:"Product Name must be at least 3 characters"}),description:g().min(3,{message:"Product description must be at least 3 characters"}),quantity:q.number()}),X=W.merge(O),de=({initialData:r,_csrf:P})=>{const p=J(),{toast:o}=R(),j=G(),y=!!r,v=r?"Edit product":"Create product",F=r?"Edit a product.":"Add a new product.",x=r?"Product updated.":"Product created.",S=r?"Save changes":"Create",N=r||{name:"",description:"",quantity:0},t=z({resolver:A(X),defaultValues:{...N,token:P}}),C=l({mutationFn:s=>V("/api/products/post",s),onSuccess:()=>{p("/dashboard/products?page=1&limit=5"),o({description:x})},onError:s=>{o({description:s.message,variant:"destructive"})}}),T=l({mutationFn:s=>$(`/api/products/put?id=${r==null?void 0:r.id}`,s),onSuccess:()=>{p("/dashboard/products?page=1&limit=5"),o({description:x})},onError:s=>{o({description:s.message,variant:"destructive"})}}),m=y?T:C,k=async s=>{m.isPending||(L({message:"Product form submitted",object:s}),j({title:"Check Updates",description:"Are you sure you want to update this user?"}).then(()=>m.mutate(s)))},u=l({mutationFn:s=>Q(`/api/products/delete?id=${s}`),onSuccess:()=>{p("/dashboard/products?page=1&limit=5"),o({description:"Product deleted."})},onError:s=>{o({description:s.message,variant:"destructive"})}}),w=async()=>{u.isPending||j({title:"Check Delete",description:"Are you sure you want to delete this user?"}).then(()=>u.mutate(r==null?void 0:r.id))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(B,{title:v,description:F}),r&&e.jsxs(f,{variant:"destructive",size:"sm",onClick:w,disabled:u.isPending,children:[u.isPending&&e.jsx(b.spinner,{className:"mr-2 size-4 animate-spin","aria-hidden":"true"}),e.jsx(K,{className:"h-4 w-4"})]})]}),e.jsx(H,{}),e.jsx(U,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(k),className:"w-full space-y-8",children:[e.jsxs("div",{className:"gap-8 md:grid md:grid-cols-3",children:[e.jsx(n,{control:t.control,name:"name",render:({field:s})=>e.jsxs(c,{children:[e.jsx(h,{children:"Name"}),e.jsx(d,{children:e.jsx(i,{placeholder:"Product name",...s})}),e.jsx(a,{})]})}),e.jsx(n,{control:t.control,name:"description",render:({field:s})=>e.jsxs(c,{children:[e.jsx(h,{children:"Description"}),e.jsx(d,{children:e.jsx(i,{placeholder:"Product description",...s})}),e.jsx(a,{})]})}),e.jsx(n,{control:t.control,name:"quantity",render:({field:s})=>e.jsxs(c,{children:[e.jsx(h,{children:"Quantity"}),e.jsx(d,{children:e.jsx(i,{type:"number",...s})}),e.jsx(a,{})]})}),e.jsx(n,{control:t.control,name:"token",render:({field:s})=>e.jsxs(c,{hidden:!0,children:[e.jsx(d,{children:e.jsx(i,{...s})}),e.jsx(a,{})]})}),e.jsx(n,{control:t.control,name:"version",render:({field:s})=>e.jsxs(c,{hidden:!0,children:[e.jsx(d,{children:e.jsx(i,{...s})}),e.jsx(a,{})]})})]}),e.jsxs(f,{className:"ml-auto",type:"submit",disabled:m.isPending,children:[m.isPending&&e.jsx(b.spinner,{className:"mr-2 size-4 animate-spin","aria-hidden":"true"}),S]})]})})]})};export{de as P};
